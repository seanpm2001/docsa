FROM python:3.7-slim

# add unprivilged user
ARG UID=1000
ARG GID=1000
RUN groupadd -g $GID slub && useradd --uid $UID --gid $GID --create-home --home-dir /home/slub -s /bin/bash slub

# install development basics
RUN apt-get update && \
    apt-get install -y git vim screen wget make && \
    rm -rf /var/lib/apt/lists/*

# setup python virtual environment
RUN python3 -m venv /home/slub/.venv
ENV PATH="/home/slub/.venv/bin:$PATH"
RUN python3 -m pip install --upgrade pip

# install development requirements
RUN pip install --no-cache-dir pylint flake8 flake8-docstrings pytest pytest-watch coverage bandit pdoc3

# pre-install python requirements
COPY code/python/requirements.txt /requirements.txt
RUN pip install --no-cache-dir -r /requirements.txt

# copy custom screenrc for convenience
COPY code/docker/devel/screenrc /home/slub/.screenrc

WORKDIR /home/slub/workspace

ENV PYTHONPATH=/home/slub/workspace/code/python/src

# change to unprivileged user
USER slub

# create .cache dir required by pylint
RUN mkdir /home/slub/.cache

ENTRYPOINT ["/bin/bash"]

